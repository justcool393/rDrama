{%- import 'util/helpers.html' as help -%}
{%- import 'html_head.html' as html_head with context -%}
<!DOCTYPE html>
<html lang="en">
{% if request.path == '/' %}
	{% set csp=CONTENT_SECURITY_POLICY_HOME %}
{% endif %}
{% if not 'post/' in request.path %}
	{{html_head.html_head(true, true, true, csp, none, "", "", true, 'post/' in request.path)}}
{% else %}
<head>
	<script defer src="{{'js/bootstrap.js' | asset}}"></script>
	<script defer src="{{'js/core.js' | asset}}"></script>

	<meta name="description" content="{{DESCRIPTION}}">

	{% if request.path == '/' %}
		<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' tls-use1.fpapi.io api.fpjs.io {% if PUSHER_ID != 'blahblahblah' %}{{PUSHER_ID}}.pushnotifications.pusher.com{% endif %}; object-src 'none';">
	{% else %}
		<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' ajax.cloudflare.com; connect-src 'self'; object-src 'none';">
	{% endif %}

	{% if v %}
		<style>:root{--primary:#{{v.themecolor}}}</style>
		<link rel="stylesheet" href="{{'css/main.css' | asset}}">
		<link rel="stylesheet" href="{{('css/'~v.theme~'.css') | asset}}">
		<link rel="stylesheet" href="{{'css/awards.css' | asset}}">
		{% if v.agendaposter %}
			<style>
				html {
					cursor:url('/i/dildo.webp?v=2000'), auto;
				}
			</style>
		{% elif v.css %}
			<style>
				{{v.css | safe}}
			</style>
		{% endif %}
	{% else %}
		<style>:root{--primary:#{{DEFAULT_COLOR}}</style>
		<link rel="stylesheet" href="{{'css/main.css' | asset}}">
		<link rel="stylesheet" href="{{('css/'~DEFAULT_THEME~'.css') | asset}}">
		<link rel="stylesheet" href="{{'css/awards.css' | asset}}">
	{% endif %}

	{% if request.path.endswith('/catalog') %}
		<link rel="stylesheet" href="{{'css/catalog.css' | asset}}">
	{% endif %}

	{% if sub and sub.css and not request.path.endswith('settings') and not request.values.get('nocss') %}
		<link rel="stylesheet" href="/h/{{sub}}/css" type="text/css">
	{% endif %}

	{% if v and v.themecolor == '30409f' %}
		<style>
			p a {
				color: #2a96f3;
			}
		</style>
	{% endif %}

	{% if SITE_NAME == 'rDrama' %}
		<style>
			.mod:before {
				content: '(((';
			}

			.mod:after {
				content: ')))';
			}
		</style>
	{% endif %}

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<meta name="thumbnail" content="{{'site_preview.webp' | asset_siteimg}}">

	<link rel="icon" type="image/webp" href="{{'icon.webp' | asset_siteimg}}">
	{% block title %}
	<title>{{SITE_NAME}}</title>

	<meta property="og:type" content="article">
	<meta property="og:title" content="{{SITE_NAME}}">
	<meta property="og:site_name" content="{{SITE}}">
	<meta property="og:image" content="{{'site_preview.webp' | asset_siteimg}}">
	<meta property="og:url" content="{{request.full_path}}">
	<meta property="og:description" name="description" content="{{SITE_NAME}} - {{DESCRIPTION}}">
	<meta property="og:author" name="author" content="{{SITE_FULL}}">

	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:site" content="{{SITE_FULL}}">
	<meta name="twitter:title" content="{{SITE_NAME}}">
	<meta name="twitter:creator" content="{{SITE_FULL}}">
	<meta name="twitter:description" content="{{SITE_NAME}} - {{DESCRIPTION}}">
	<meta name="twitter:image" content="{{'site_preview.webp' | asset_siteimg}}">
	<meta name="twitter:url" content="{{request.full_path}}">
	{% endblock %}

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="format-detection" content="telephone=no">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	{{html_head.seo()}}
		{% if 'slackernews' in request.path %}
			<meta name="cf-2fa-verify" content="ea6d12c0fb87b3b">
		{% elif SITE == 'rdrama.net' %}
			<meta name="cf-2fa-verify" content="4f40ca1ca249313">
		{% elif SITE == 'watchpeopledie.tv' %}
			<meta name="cf-2fa-verify" content="372aba5b9338e00">
		{% elif SITE == 'pcmemes.net' %}
			<meta name="cf-2fa-verify" content="bf22ffe56e4bcda">
		{% endif %}
 </head>
{% endif %}


 <body id="{% if request.path != '/comments' %}{% block pagetype %}frontpage{% endblock %}{% endif %}" {% if SITE_NAME == 'rDrama' and v and (v.is_banned or v.agendaposter) %}style="overflow-x: hidden;background:url(/assets/images/backgrounds/anime/1.webp?v=3) center center fixed; background-color: var(--background)"{% elif v and v.background %}style="{% if path != '/formatting' %}overflow-x: hidden; {% endif %} background:url(/assets/images/backgrounds/{{v.background}}?v=3) center center fixed; background-color: var(--background){% if 'anime' not in v.background %};background-size: cover{% endif %}"{% endif %}>

{% block Banner %}
	{% include "expanded_image_modal.html" %}

	{% if '@' not in request.path %}	
		{% if sub and SITE_NAME != 'WPD' %}
			<a href="{{sub.banner_url}}">
				<img alt="/h/{{sub}} banner" onclick="expandDesktopImage()" src="{{sub.banner_url}}" width=100% style="object-fit:cover;max-height:min(42vh,30vw)!important">
			</a>
		{% elif SITE_NAME == 'rDrama' %}
			<a rel="nofollow noopener noreferrer" href="https://secure.transequality.org/site/Donation2?df_id=1480">
				{% if v and (v.is_banned or v.agendaposter) %}
					<img alt="site banner" src="/i/{{SITE_NAME}}/banner2.webp?v=2000" width="100%">
				{% else %}
					{% set path = "assets/images/" + SITE_NAME + "/banners" %}
					{% set image = "/" + path + "/" + listdir('files/' + path)|random() + '?v=25' %}
					<img alt="site banner" src="{% if v %}{{image}}{% else %}{{'cached.webp' | asset_siteimg}}{% endif %}" width="100%">
				{% endif %}
			</a>
		{% elif SITE_NAME == 'WPD' %}
			{% if v %}
				{% set path = "assets/images/" + SITE_NAME + "/banners" %}
				{% set banner = "/" + path + "/" + listdir('files/' + path)|random() + '?v=1' %}
			{% else %}
				{% set banner = 'cached.webp' | asset_siteimg %}
			{% endif %}
			<a href="{{banner}}">
				<img alt="site banner" onclick="expandDesktopImage()" src="{{banner}}" width="100%">
			</a>
		{% else %}
			{% if SITE_NAME == 'PCM' %}
				{% set path = "assets/images/" + SITE_NAME + "/banners" %}
				{% set banner = "/" + path + "/" + listdir('files/' + path)|max + '?v=1' %}
			{% else %}
				{% set banner = 'banner.webp' | asset_siteimg %}
			{% endif %}

			<a href="{{banner}}">
				<img alt="site banner" onclick="expandDesktopImage()" src="{{banner}}" width="100%">
			</a>
		{% endif %}
	{% endif %}
{% endblock %}

{% include "header.html" %}

{% block mobileUserBanner %}
{% endblock %}

<div class="container">
	<div class="row justify-content-around" id="main-content-row">

		<div class="col h-100 {% block customPadding %}{% if request.path.startswith('/@') %}user-gutters{% else %}custom-gutters{% endif %}{% endblock %}" id="main-content-col">

			{% block desktopUserBanner %}
			{% endblock %}

			{% block desktopBanner %}
			{% endblock %}

			{% block PseudoSubmitForm %}
			{% endblock %}

			{% block searchText %}
			{% endblock %}

			{% block content %}
			{% endblock %}

			{% block pagenav %}
			{% endblock %}

		</div>
		{% block sidebar %}
			{% if has_sidebar and (home or p) %}
				{% include "sidebar_" + SITE_NAME + ".html" %}
			{% endif %}
		{% endblock %}
	</div>
</div>

{% block mobilenavbar %}
	{% include "mobile_navigation_bar.html" %}
{% endblock %}

{% block actionsModal %}
{% endblock %}

{% block reportCommentModal %}
{% endblock %}

{% block GIFtoast %}
{% endblock %}

{% block GIFpicker %}
{% endblock %}


<div class="toast clipboard" id="toast-success" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="true" data-bs-delay="5000">
	<div class="toast-body text-center">
		<i class="fas fa-check-circle text-success mr-2"></i>Link copied to clipboard
	</div>
</div>

<div class="toast" id="toast-post-success" style="position: fixed; bottom: 1.5rem; margin: 0 auto; left: 0; right: 0; width: 275px; z-index: 1000" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="true" data-bs-delay="5000">
	<div class="toast-body bg-success text-center text-white">
		<i class="fas fa-comment-alt-smile mr-2"></i><span id="toast-post-success-text">Action successful!</span>
	</div>
</div>
<div class="toast" id="toast-post-error" style="position: fixed; bottom: 1.5rem; margin: 0 auto; left: 0; right: 0; width: 275px; z-index: 1000" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="true" data-bs-delay="5000">
	<div class="toast-body bg-danger text-center text-white">
		<i class="fas fa-exclamation-circle mr-2"></i><span id="toast-post-error-text">Error, please try again later.</span>
	</div>
</div>

<script defer src="{{'js/lozad.js' | asset}}"></script>

{% if v %}
	<script defer src="{{'js/formatting.js' | asset}}"></script>
{% endif %}

<script defer src="{{'js/lite-youtube.js' | asset}}"></script>

{% if v and v.spider %}
	<script defer src="{{'js/critters.js' | asset}}"></script>
	<script defer src="{{'js/spider.js' | asset}}"></script>
{% endif %}
</body>

</html>
